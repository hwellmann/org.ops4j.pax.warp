<?xml version="1.0" encoding="UTF-8"?>

<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema" targetNamespace="urn:org.ops4j.pax.warp:changelog:0.1"
    xmlns="urn:org.ops4j.pax.warp:changelog:0.1" elementFormDefault="qualified">


    <xsd:element name="changeLog">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:choice minOccurs="0" maxOccurs="unbounded">
                    <xsd:element name="changeSet" type="ChangeSet" />
                    <xsd:element name="include" type="Include" />
                </xsd:choice>
            </xsd:sequence>
            <xsd:attribute name="version" type="xsd:string" use="required" />
        </xsd:complexType>
    </xsd:element>

    <xsd:complexType name="ColumnReference">
        <xsd:attribute name="columnName" type="xsd:string" use="required" />
    </xsd:complexType>

    <xsd:complexType name="TableReference">
        <xsd:attributeGroup ref="tableNameAttributes" />
    </xsd:complexType>

    <xsd:simpleType name="SqlType">
        <xsd:restriction base="xsd:string">
            <xsd:enumeration value="int8" />
            <xsd:enumeration value="int16" />
            <xsd:enumeration value="int32" />
            <xsd:enumeration value="int64" />
            <xsd:enumeration value="decimal" />
            <xsd:enumeration value="float" />
            <xsd:enumeration value="double" />
            <xsd:enumeration value="char" />
            <xsd:enumeration value="varchar" />
            <xsd:enumeration value="clob" />
            <xsd:enumeration value="blob" />
            <xsd:enumeration value="boolean" />
            <xsd:enumeration value="date" />
            <xsd:enumeration value="time" />
            <xsd:enumeration value="timestamp" />
        </xsd:restriction>
    </xsd:simpleType>

    <xsd:attributeGroup name="createIndex">
        <xsd:attributeGroup ref="tableNameAttributes" />
        <xsd:attribute name="indexName" type="xsd:string" use="required" />
        <xsd:attribute name="associatedWith" type="xsd:string" />
        <xsd:attribute name="unique" type="xsd:boolean" />
        <xsd:attribute name="clustered" type="xsd:boolean" />
        <xsd:attribute name="tablespace" type="xsd:string" />
    </xsd:attributeGroup>

    <xsd:attributeGroup name="sequenceAttributes">
        <xsd:attribute name="catalogName" type="xsd:string" />
        <xsd:attribute name="schemaName" type="xsd:string" />
        <xsd:attribute name="sequenceName" type="xsd:string" use="required" />
        <xsd:attribute name="startValue" type="xsd:string" />
        <xsd:attribute name="incrementBy" type="xsd:string" />
        <xsd:attribute name="maxValue" type="xsd:string" />
        <xsd:attribute name="minValue" type="xsd:string" />
        <xsd:attribute name="ordered" type="xsd:boolean" />
        <xsd:attribute name="cacheSize" type="xsd:nonNegativeInteger" />
    </xsd:attributeGroup>

    <xsd:attributeGroup name="tableNameAttributes">
        <xsd:attribute name="catalogName" type="xsd:string" />
        <xsd:attribute name="schemaName" type="xsd:string" />
        <xsd:attribute name="tableName" type="xsd:string" use="required" />
    </xsd:attributeGroup>

    <xsd:complexType name="ChangeSet">
        <xsd:sequence>
            <xsd:element ref="comment" minOccurs="0" />
            <xsd:choice maxOccurs="unbounded">
                <xsd:element name="createTable" type="CreateTable" />
                <xsd:element name="addPrimaryKey" type="AddPrimaryKey" />
                <xsd:element name="addForeignKey" type="AddForeignKey" />
                <xsd:element name="dropForeignKey" type="DropForeignKey" />
                <xsd:element name="dropPrimaryKey" type="DropPrimaryKey" />
                <xsd:element name="truncateTable" type="TruncateTable" />
                <xsd:element name="dropTable" type="DropTable" />
                <xsd:element name="insert" type="Insert" />
                <xsd:element ref="createView" />
                <xsd:element ref="createSequence" />
                <xsd:element ref="createIndex" />
                <xsd:element ref="addUniqueConstraint" />

            </xsd:choice>
        </xsd:sequence>
        <xsd:attribute name="id" type="xsd:string" use="required" />
        <xsd:attribute name="dbms" type="xsd:string" />
    </xsd:complexType>

    <xsd:complexType name="Include">
        <xsd:attribute name="file" type="xsd:string" use="required" />
        <xsd:attribute name="relativeToChangelogFile" type="xsd:boolean" />
    </xsd:complexType>

    <xsd:element name="comment" type="xsd:string" />


    <xsd:complexType name="AddForeignKey">
        <xsd:sequence>
            <xsd:element name="baseTable" type="TableReference" />
            <xsd:element name="referencedTable" type="TableReference" />
            <xsd:element name="columnPair" type="ColumnPair" maxOccurs="unbounded" />
        </xsd:sequence>
        <xsd:attribute name="constraintName" type="xsd:string" use="required" />
        <xsd:attribute name="deferrable" type="xsd:boolean" />
        <xsd:attribute name="initiallyDeferred" type="xsd:boolean" />
        <xsd:attribute name="deleteCascade" type="xsd:boolean" />
        <xsd:attribute name="onDelete" type="fkCascadeActionOptions" />
        <xsd:attribute name="onUpdate" type="fkCascadeActionOptions" />
        <xsd:attribute name="referencesUniqueColumn" type="xsd:boolean" />
    </xsd:complexType>

    <xsd:complexType name="DropForeignKey">
        <xsd:sequence>
            <xsd:element name="baseTable" type="TableReference" />
        </xsd:sequence>
        <xsd:attribute name="constraintName" type="xsd:string" use="required" />
    </xsd:complexType>

    <xsd:complexType name="DropPrimaryKey">
        <xsd:attributeGroup ref="tableNameAttributes" />
        <xsd:attribute name="constraintName" type="xsd:string" />
    </xsd:complexType>

    <xsd:complexType name="ColumnPair">
        <xsd:sequence>
            <xsd:element name="base" type="ColumnReference" />
            <xsd:element name="referenced" type="ColumnReference" />
        </xsd:sequence>
    </xsd:complexType>


    <xsd:complexType name="AddPrimaryKey">
        <xsd:sequence>
            <xsd:element name="column" type="xsd:string" maxOccurs="unbounded" />
        </xsd:sequence>
        <xsd:attributeGroup ref="tableNameAttributes" />
        <xsd:attribute name="constraintName" type="xsd:string" />
        <xsd:attribute name="tablespace" type="xsd:string" />
        <xsd:attribute name="clustered" type="xsd:boolean" />
    </xsd:complexType>


    <xsd:element name="addUniqueConstraint">
        <xsd:complexType>
            <xsd:attributeGroup ref="tableNameAttributes" />
            <xsd:attribute name="columnNames" type="xsd:string" use="required" />
            <xsd:attribute name="constraintName" type="xsd:string" />
            <xsd:attribute name="tablespace" type="xsd:string" />
            <xsd:attribute name="disabled" type="xsd:boolean" />
            <xsd:attribute name="deferrable" type="xsd:boolean" />
            <xsd:attribute name="initiallyDeferred" type="xsd:boolean" />
        </xsd:complexType>
    </xsd:element>

    <xsd:complexType name="Column">
        <xsd:sequence>
            <xsd:element name="constraints" type="Constraints" minOccurs="0" />
        </xsd:sequence>
        <xsd:attribute name="name" type="xsd:string" />
        <xsd:attribute name="type" type="SqlType" />
        <xsd:attribute name="primaryKey" type="xsd:boolean" />
        <xsd:attribute name="length" type="xsd:int" />
        <xsd:attribute name="precision" type="xsd:int" />
        <xsd:attribute name="scale" type="xsd:int" />
        <xsd:attribute name="defaultValue" type="xsd:string" />
        <xsd:attribute name="autoIncrement" type="xsd:boolean" />
    </xsd:complexType>

    <xsd:complexType name="Constraints">
        <xsd:attribute name="nullable" type="xsd:boolean" />
        <xsd:attribute name="primaryKey" type="xsd:boolean" />
        <xsd:attribute name="primaryKeyName" type="xsd:string" />
        <xsd:attribute name="primaryKeyTablespace" type="xsd:string" />
        <xsd:attribute name="unique" type="xsd:boolean" />
        <xsd:attribute name="uniqueConstraintName" type="xsd:string" />
        <xsd:attribute name="references" type="xsd:string" />
        <xsd:attribute name="referencedTableName" type="xsd:string" />
        <xsd:attribute name="referencedColumnNames" type="xsd:string" />
        <xsd:attribute name="foreignKeyName" type="xsd:string" />
        <xsd:attribute name="deleteCascade" type="xsd:boolean" />
        <xsd:attribute name="deferrable" type="xsd:boolean" />
        <xsd:attribute name="initiallyDeferred" type="xsd:boolean" />
        <xsd:attribute name="checkConstraint" type="xsd:string" />
    </xsd:complexType>

    <xsd:element name="createIndex">
        <xsd:complexType>
            <xsd:sequence>
                <xsd:element name="column" type="Column" maxOccurs="unbounded" />
            </xsd:sequence>
            <xsd:attributeGroup ref="createIndex" />
        </xsd:complexType>
    </xsd:element>

    <xsd:element name="createSequence">
        <xsd:complexType>
            <xsd:attributeGroup ref="sequenceAttributes" />
            <xsd:attribute name="cycle" type="xsd:boolean" />
        </xsd:complexType>
    </xsd:element>

    <xsd:complexType name="CreateTable">
        <xsd:sequence>
            <xsd:element name="column" type="Column" maxOccurs="unbounded" />
        </xsd:sequence>
        <xsd:attributeGroup ref="tableNameAttributes" />
        <xsd:attribute name="tablespace" type="xsd:string" />
        <xsd:attribute name="remarks" type="xsd:string" />
    </xsd:complexType>

    <xsd:complexType name="DropTable">
        <xsd:attributeGroup ref="tableNameAttributes" />
    </xsd:complexType>

    <xsd:complexType name="TruncateTable">
        <xsd:attributeGroup ref="tableNameAttributes" />
    </xsd:complexType>

    <xsd:element name="createView">
        <xsd:complexType>
            <xsd:simpleContent>
                <xsd:extension base="xsd:string">
                    <xsd:attribute name="catalogName" type="xsd:string" />
                    <xsd:attribute name="schemaName" type="xsd:string" />
                    <xsd:attribute name="viewName" type="xsd:string" use="required" />
                    <xsd:attribute name="replaceIfExists" type="xsd:boolean" />
                    <xsd:attribute name="fullDefinition" type="xsd:boolean" />
                </xsd:extension>
            </xsd:simpleContent>
        </xsd:complexType>
    </xsd:element>

    <xsd:complexType name="Insert">
        <xsd:sequence>
            <xsd:element name="column" type="ColumnValue" maxOccurs="unbounded" />
        </xsd:sequence>
        <xsd:attributeGroup ref="tableNameAttributes" />
        <xsd:attribute name="dbms" type="xsd:string" />
    </xsd:complexType>

    <xsd:complexType name="ColumnValue">
        <xsd:simpleContent>
            <xsd:extension base="xsd:string">
                <xsd:attribute name="name" type="xsd:string" />
                <xsd:attribute name="type" type="xsd:string" />
            </xsd:extension>
        </xsd:simpleContent>
    </xsd:complexType>


    <xsd:simpleType name="fkCascadeActionOptions">
        <xsd:restriction base="xsd:token">
            <xsd:enumeration value="CASCADE" />
            <xsd:enumeration value="SET NULL" />
            <xsd:enumeration value="SET DEFAULT" />
            <xsd:enumeration value="RESTRICT" />
            <xsd:enumeration value="NO ACTION" />
        </xsd:restriction>
    </xsd:simpleType>

</xsd:schema>
